/* $Id$ */

/*
 * Copyright 2002-2011, The TenDRA Project.
 * Copyright 1997, United Kingdom Secretary of State for Defence.
 *
 * See doc/copyright/ for the full copyright terms.
 */

#include <stdio.h>
#include <string.h>
#include <assert.h>

#include <shared/error.h>

#include "output.h"

void
output_indent(FILE *out, unsigned int depth)
{
	while (depth-- > 0) {
		fputc('\t', out);
	}
}

int
output_comment_file(enum output_comment com, FILE *output, FILE *input)
{
	char buf[BUFSIZ];
	char *start;
	char *middle;
	char *end;

	switch(com) {
	case OUTPUT_COMMENT_C90:
	case OUTPUT_COMMENT_C99:
		start  = "/*";
		middle = " *";
		end    = " */";
		break;
	}

	fprintf(output, "%s \n%s ", start, middle);

	while (1) {
		buf[BUFSIZ - 1] = 'x';

		if (!fgets(buf, sizeof buf, input)) {
			break;
		}

		if (strstr(buf, end)) {
			return 0;
		}

		fputs(buf, output);

		if (!(buf[BUFSIZ - 1] == '\0' && buf[BUFSIZ - 2] != '\n')) {
			fprintf(output, "%s ", middle);
		}
	}

	fprintf(output, "\n%s\n\n", end);

	return 1;
}

void
output_generated_by_lexi(enum output_comment com, FILE *out)
{
	assert(com == OUTPUT_COMMENT_C90 || com == OUTPUT_COMMENT_C99);

	fprintf(out, "\n/*"
	             "\n * Automatically generated by %s version %s"
	             "\n */\n\n", progname, progvers);
}

